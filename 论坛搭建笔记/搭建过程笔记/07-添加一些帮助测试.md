# 07-添加一些帮助测试
现在论坛的功能有：
1.用户登录、注册(Auth、User)
2.话题功能(Thread)
3.回复话题(Reply)
4.已注册用户可以添加回复，未注册用户不能添加回复

Feather测试有：
1.阅读话题(话题列表测试、单个话题测试、读取回复测试)
2.参与论坛讨论(已注册用户可以发表回复、未注册用户无法发表)
3.创建话题(已注册用户可以创建话题、未注册用户无法创建话题)

用到的Feather和Unit测试方法：

```
01.factory(class)->create(); //7
02.factory(class)->make(); //3
03.$this->actingAs(); //1
04.$this->be(); //1
05.$this->get(); //5
06.$this->post(); //4
07.$this->assertSee(); //6
08.$this->expectException(); //2
09.$this->assertInstanceOf(); //3
10.$this->assertCount(); //1
```

接下来开始添加一些帮助测试
1.需要添加一些额外的函数规则，可以让它们自动加载，配置composer.json中添加：

```
 "autoload-dev": {
    "psr-4": {
        "Tests\\": "tests/"
   },
     "files": ["tests/utilities/function.php"]
},
```
原因见[composer autoload-dev](https://docs.phpcomposer.com/04-schema.html)
然后新建文件 tests/utilities/function.php

2.简化一下make和create函数

```
<?php

function create($class, $attributes = [])
{
	return factory($class)->create($attributes);
}

function make($class, $attributes = [])
{
	return factory($class)->make($attributes);
}
```
先在某个测试函数中替换`factory()->make()`为`make()`测试

直接测试会出现找不到make()函数的提示：

```
1) Tests\Feature\CreateThreadsTest::guests_may_not_create_threads
Failed asserting that exception of type "Error" matches expected exception "Illuminate\Auth\AuthenticationException". Message was: "Call to undefined function Tests\Feature\make()" at
/Users/monstercat/Gist/Forum/tests/Feature/CreateThreadsTest.php:34
.
```
这是因为要重载一下composer，才会起作用：

```
composer dump-autoload
```
之后再测试就没问题了，然后依次替换其他的make和create方法。

3.简化获取登陆用户`$this->be();`
在tests/TestCase中添加signIn函数

```
protected function signIn($user = null)
{
	$user = $user ?: create('App\User');

	$this->actingAs($user);

	return $this;
}
```
将`$this->actingAs(create('App\User'));`换为`signIn`




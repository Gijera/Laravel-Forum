# 16-元信息和分页
### 获得`$thread`的回复数量
1.获得回复数量`{{ $thread->replies->count() }}` 以及 `{{ $thread->replies()->count() }}`

当调用`$thread->replies`时，返回的是`Illuminate\Database\Eloquent\Collection`集合类型，这是因为`一旦定义好两者之间关联，我们就可以通过使用 Eloquent 的动态属性来获取关联记录。动态属性允许你访问关联方法，如同他们是定义在模型中的属性`。而调用`$thread->replies()`时，返回的是`Illuminate\Database\Eloquent\Relations\HasMany`，是一个关系类型，但它也同时是一个查询构造器，因为`所有的关联也都提供了查询语句构造器的功能`。

* 具体可以查看[关系模型](d.laravel-china.org/docs/5.4/eloquent-relationships.html)

* 集合的`count()`方法参考[count](https://laravel.com/docs/5.5/collections#method-count)。

* 查询构造器的`count()`方法参考[聚合](d.laravel-china.org/docs/5.4/queries.html#聚合)。


2.`Thread::withCount('replies')->first();`
> 如果你想对关联数据进行计数但又不想再发起单独的 SQL 请求，你可以使用 withCount 方法，此方法会在你的结果集中增加一个 {relation}_count 字段.参考[关联数据计数](d.laravel-china.org/docs/5.4/eloquent-relationships.html#关联数据计数)

3.Thread.php中添加：

```
protected static function boot()
{
    parent::boot();

    static::addGlobalScope('replyCount', function($builder){
        $builder->withCount('replies');
    });
}
```
之后可以直接调用`$thread->replies_count`获得数据，这一部分内容可以参考[匿名的全局作用域](d.laravel-china.org/docs/5.4/eloquent.html#匿名的全局作用域)。这一步相当于把replies_count这个属性添加到了Thread类。

4.自动单复数`{{ str_plural('comment', $thread->replies_count) }}`
参考[辅助方法](d.laravel-china.org/docs/5.4/helpers.html#collection-method)

### 分页
Laravel对于分页的支持非常强大，所以很简单就能对所有的回复分页：

```
<?php $replies = $thread->replies()->paginate(1);?>

@foreach ($replies as $reply)
    @include('threads.reply')
@endforeach

{{ $replies->links() }}
```
上面使用了[对查询语句构造器进行分页](d.laravel-china.org/docs/5.4/pagination.html#对查询语句构造器进行分页)，还有[显示分页结果](d.laravel-china.org/docs/5.4/pagination.html#显示分页结果)。

